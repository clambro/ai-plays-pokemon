<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>AI Plays Pokemon</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Orbitron:wght@400;700;900&display=swap');

        :root {
            --main-bg-color: #0f1923;
            --panel-bg-color: rgba(10, 25, 47, 0.7);
            --border-color: #00d4ff;
            --text-color: #e6f1ff;
            --highlight-color: #ffd700;
            --font-body: 'Roboto Mono', monospace;
            --font-title: 'Orbitron', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--main-bg-color);
            color: var(--text-color);
            width: 1920px;
            height: 1080px;
            overflow: hidden;
        }

        .stream-layout {
            display: grid;
            width: 100%;
            height: 100%;
            grid-template-rows: auto auto 1fr auto;
            grid-template-columns: 1fr 380px 620px;
            grid-template-areas:
                "header header header"
                "info info info"
                "log goals game"
                "party party party";
            gap: 15px;
            padding: 20px;
        }

        .panel {
            background-color: var(--panel-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            backdrop-filter: blur(5px);
        }

        /* --- Header --- */
        .title-bar {
            grid-area: header;
            text-align: center;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: -5px;
        }

        .title-bar h1 {
            font-family: var(--font-title);
            font-size: 48px;
            font-weight: 900;
            letter-spacing: 4px;
            color: var(--text-color);
            text-shadow: 0 0 15px var(--border-color);
        }

        .title-bar p {
            font-size: 20px;
            color: var(--highlight-color);
            letter-spacing: 2px;
        }

        /* --- Info Bar --- */
        .info-bar {
            grid-area: info;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .info-item {
            text-align: center;
        }

        .info-item .label {
            font-size: 14px;
            color: var(--border-color);
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .info-item .value {
            font-family: var(--font-title);
            font-size: 28px;
            font-weight: 700;
        }

        #badges-container {
            display: flex;
            gap: 10px;
        }

        .badge-icon {
            width: 32px;
            height: 32px;
            opacity: 0.3;
            filter: grayscale(100%);
        }

        .badge-icon.earned {
            opacity: 1;
            filter: none;
        }


        /* --- Log Panel --- */
        .log-panel {
            grid-area: log;
            display: flex;
            flex-direction: column;
        }

        .log-panel h3 {
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        #log-content {
            flex-grow: 1;
            overflow-y: auto;
            padding-top: 10px;
            font-size: 14px;
        }

        /* TODO: Add styles for log entries */

        /* --- Goals Panel --- */
        .goals-panel {
            grid-area: goals;
            display: flex;
            flex-direction: column;
        }

        .goals-panel h3 {
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        #goals {
            flex-grow: 1;
            padding-top: 10px;
            list-style-type: none;
            padding-left: 0;
        }

        .goal {
            font-size: 14px;
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            margin-bottom: 8px;
            margin-top: 30px;
            /* Adjust to position vertically */
        }

        /* --- Game Window --- */
        .game-window-area {
            grid-area: game;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
        }

        .game-window-placeholder {
            width: 600px;
            height: 540px;
            border: 2px dashed var(--border-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: var(--border-color);
            opacity: 0.6;
            margin-top: 30px;
            /* Adjust to position vertically */
        }

        .game-window-placeholder .title {
            font-size: 24px;
            font-weight: bold;
        }

        .game-window-placeholder .subtitle {
            font-size: 16px;
        }


        /* --- Party Bar --- */
        .party-bar {
            grid-area: party;
        }

        #party {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            align-items: stretch;
            /* Makes cards equal height */
            padding-top: 10px;
        }

        .pokemon-card {
            background: linear-gradient(145deg, #16213e, #0f1923);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            flex: 1;
            /* Make all cards share space equally */
            display: flex;
            flex-direction: column;
            text-align: center;
        }

        .pokemon-sprite {
            width: 80px;
            height: 80px;
            margin: 0 auto;
            image-rendering: pixelated;
        }

        .pokemon-name {
            font-family: var(--font-title);
            font-weight: bold;
            color: var(--highlight-color);
            font-size: 16px;
            margin-top: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 12px;
            color: var(--border-color);
            margin-bottom: 5px;
        }

        .pokemon-species {
            font-size: 12px;
            color: var(--border-color);
            margin-bottom: 5px;
        }

        .pokemon-level {
            color: var(--border-color);
            font-size: 12px;
        }

        .hp-bar {
            background: #111;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0 4px;
            border: 1px solid #000;
        }

        .hp-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .hp-text {
            font-size: 11px;
            color: #ccc;
        }

        .status {
            font-size: 11px;
            color: #ff6b6b;
            font-weight: bold;
            height: 14px;
            /* Reserve space to prevent layout shift */
            margin-top: 4px;
        }

        .moves-list {
            list-style: none;
            padding: 0;
            margin-top: auto;
            /* Pushes moves to the bottom */
            font-size: 11px;
        }

        .moves-list li {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
            padding: 2px 4px;
            margin-top: 4px;
        }

        .type-badge-container {
            height: 20px;
            /* Reserve space */
            margin-bottom: 5px;
        }

        .type-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .type-normal {
            background: #A8A878;
            color: white;
        }

        .type-fire {
            background: #F08030;
            color: white;
        }

        .type-water {
            background: #6890F0;
            color: white;
        }

        .type-electric {
            background: #F8D030;
            color: black;
        }

        .type-grass {
            background: #78C850;
            color: white;
        }

        .type-ice {
            background: #98D8D8;
            color: black;
        }

        .type-fighting {
            background: #C03028;
            color: white;
        }

        .type-poison {
            background: #A040A0;
            color: white;
        }

        .type-ground {
            background: #E0C068;
            color: black;
        }

        .type-flying {
            background: #A890F0;
            color: white;
        }

        .type-psychic {
            background: #F85888;
            color: white;
        }

        .type-bug {
            background: #A8B820;
            color: white;
        }

        .type-rock {
            background: #B8A038;
            color: white;
        }

        .type-ghost {
            background: #705898;
            color: white;
        }

        .type-dragon {
            background: #7038F8;
            color: white;
        }
    </style>
</head>

<body>
    <div class="stream-layout">
        <header class="title-bar">
            <h1>AI PLAYS POKEMON</h1>
            <p>Pokemon Yellow Legacy: HARD MODE!</p>
        </header>

        <section class="info-bar panel">
            <div class="info-item">
                <div class="label">ITERATION</div>
                <div class="value" id="iteration">0</div>
            </div>
            <div class="info-item">
                <div class="label">PLAY TIME</div>
                <div class="value" id="play-time">0h 0m</div>
            </div>
            <div class="info-item">
                <div class="label">LLM COST</div>
                <div class="value" id="total-cost">$0.00</div>
            </div>
            <div class="info-item">
                <div class="label">MONEY</div>
                <div class="value" id="money">¥0</div>
            </div>
            <div class="info-item">
                <div class="label">BADGES</div>
                <div class="value" id="badges-container">
                    <!-- Badge icons will be injected here -->
                </div>
            </div>
            <div class="info-item">
                <div class="label">SEEN/CAUGHT</div>
                <div class="value" id="seen-caught">0/0</div>
            </div>
        </section>

        <main class="log-panel panel">
            <h3>AGENT LOG</h3>
            <div id="log-content">
                <!-- Log content will be dynamically inserted here -->
            </div>
        </main>

        <aside class="goals-panel panel">
            <h3>GOALS</h3>
            <ul id="goals">
                <!-- Goals will be dynamically inserted here -->
                <li class="no-data">Awaiting objectives...</li>
            </ul>
        </aside>

        <aside class="game-window-area">
            <div class="game-window-placeholder">
                <p class="title">GAME WINDOW</p>
                <p class="subtitle">10:9 Aspect Ratio</p>
            </div>
        </aside>

        <footer class="party-bar panel">
            <div id="party">
                <!-- Pokemon party cards will be dynamically inserted here -->
            </div>
        </footer>
    </div>


    <script>
        const ALL_BADGES = [
            "BOULDERBADGE", "CASCADEBADGE", "THUNDERBADGE", "RAINBOWBADGE",
            "SOULBADGE", "MARSHBADGE", "VOLCANOBADGE", "EARTHBADGE"
        ];

        function updateDisplay(data) {
            // --- Info Bar ---
            document.getElementById('money').textContent = `¥${data.money.toLocaleString()}`;
            document.getElementById('iteration').textContent = data.iteration;
            document.getElementById('seen-caught').textContent = `${data.pokedex_seen}/${data.pokedex_caught}`;
            document.getElementById('total-cost').textContent = `$${data.total_cost.toFixed(2)}`;

            const hours = Math.floor(data.play_time_seconds / 3600);
            const minutes = Math.floor((data.play_time_seconds % 3600) / 60);
            document.getElementById('play-time').textContent = `${hours}h ${minutes}m`;


            // --- Badges ---
            const badgesContainer = document.getElementById('badges-container');
            badgesContainer.innerHTML = ''; // Clear old badges
            ALL_BADGES.forEach(badgeName => {
                const badgeImg = document.createElement('img');
                badgeImg.src = `/static/badges/${badgeName.toLowerCase()}.png`;
                badgeImg.title = badgeName;
                badgeImg.className = 'badge-icon';
                if (data.badges.includes(badgeName)) {
                    badgeImg.classList.add('earned');
                }
                badgesContainer.appendChild(badgeImg);
            });


            // --- Goals ---
            const goalsDiv = document.getElementById('goals');
            goalsDiv.innerHTML = ''; // Clear old goals
            if (data.goals && data.goals.length > 0) {
                data.goals.forEach((goal) => {
                    const goalEl = document.createElement('li');
                    goalEl.className = 'goal';
                    goalEl.textContent = goal;
                    goalsDiv.appendChild(goalEl);
                });
            } else {
                goalsDiv.innerHTML = '<li class="no-data">Awaiting objectives...</li>';
            }

            // --- Log ---
            // The log data needs to be added to the state payload first.
            const logDiv = document.getElementById('log-content');
            logDiv.innerHTML = '';
            if (data.log && data.log.length > 0) {
                data.log.forEach(entry => {
                    const p = document.createElement('p');
                    p.textContent = `[${entry.iteration}] ${entry.thought}`;
                    logDiv.appendChild(p);
                });
            }


            // --- Party ---
            const partyDiv = document.getElementById('party');
            partyDiv.innerHTML = ''; // Clear old party
            if (data.party && data.party.length > 0) {
                data.party.forEach(pokemon => {
                    const hpPercent = (pokemon.hp / pokemon.max_hp) * 100;
                    let hpColor;
                    if (hpPercent > 50) hpColor = '#33ff33';
                    else if (hpPercent > 20) hpColor = '#fde64b';
                    else hpColor = '#ff3333';

                    const card = document.createElement('div');
                    card.className = 'pokemon-card';

                    let movesHtml = pokemon.moves.map(move => `<li>${move}</li>`).join('');

                    card.innerHTML = `
                        <img class="pokemon-sprite" src="/static/pokemon_sprites/${pokemon.species.toLowerCase()}.png" alt="${pokemon.species}">
                        <div class="pokemon-name" title="${pokemon.name}">${pokemon.name}</div>
                        <div class="pokemon-species">${pokemon.species} - <span class="pokemon-level">Lv.${pokemon.level}</span></div>
                        <div class="type-badge-container">
                            ${pokemon.type1 ? `<span class="type-badge type-${pokemon.type1.toLowerCase()}">${pokemon.type1}</span>` : ''}
                            ${pokemon.type2 ? `<span class="type-badge type-${pokemon.type2.toLowerCase()}">${pokemon.type2}</span>` : ''}
                        </div>
                        <div class="hp-bar">
                            <div class="hp-fill" style="width: ${hpPercent}%; background-color: ${hpColor};"></div>
                        </div>
                        <div class="hp-text">${pokemon.hp} / ${pokemon.max_hp}</div>
                        <div class="status">${pokemon.status !== 'NONE' ? pokemon.status : ''}</div>
                        <ul class="moves-list">${movesHtml}</ul>
                    `;
                    partyDiv.appendChild(card);
                });
            }
        }

        async function fetchData() {
            try {
                // In a real scenario, you'd fetch this from your Python server
                // const response = await fetch('/api/state.json');
                // const data = await response.json();

                // Using mock data for demonstration
                const mockData = {
                    iteration: 15247,
                    money: 18143,
                    pokedex_seen: 45,
                    pokedex_caught: 21,
                    total_cost: 23.51,
                    play_time_seconds: 596153, // about 165 hours
                    badges: ["BOULDERBADGE", "CASCADEBADGE", "THUNDERBADGE"],
                    party: [
                        { name: 'ECHO', species: 'Golbat', type1: 'POISON', type2: 'FLYING', level: 22, hp: 22, max_hp: 70, status: 'POISON', moves: ['Wing Attack', 'Confuse Ray', 'Bite', 'Haze'] },
                        { name: 'CRAG', species: 'Geodude', type1: 'ROCK', type2: 'GROUND', level: 18, hp: 45, max_hp: 45, status: 'NONE', moves: ['Tackle', 'Defense Curl', 'Rock Throw', 'Self-Destruct'] },
                        { name: 'NIGHTSHADE', species: 'Gloom', type1: 'GRASS', type2: 'POISON', level: 23, hp: 73, max_hp: 73, status: 'NONE', moves: ['Acid', 'Petal Dance', 'Sleep Powder', 'Absorb'] },
                        { name: 'PULSAR', species: 'Magnemite', type1: 'ELECTRIC', level: 18, hp: 36, max_hp: 36, status: 'NONE', moves: ['Tackle', 'Sonic Boom', 'Thunder Shock', 'Supersonic'] },
                        { name: 'SPARKY', species: 'Pikachu', level: 24, hp: 68, max_hp: 68, status: 'NONE', moves: ['Thunder Shock', 'Growl', 'Thunder Wave', 'Quick Attack'] },
                        { name: 'SUBTERRA', species: 'Diglett', type1: 'GROUND', level: 18, hp: 18, max_hp: 52, status: 'NONE', moves: ['Scratch', 'Growl', 'Dig', 'Sand Attack'] },
                    ],
                    goals: [
                        "Travel through Rock Tunnel to reach Lavender Town.",
                        "Obtain HM05 (Flash).",
                        "Acquire a drink for the Saffron City guard."
                    ],
                    log: [
                        { iteration: 15247, thought: "Ugh, a random battle. My path traversal was interrupted. I'm facing a wild Diglett. My goal is to get out of here, not to battle. ECHO is a higher level, so I should be able to run away successfully. I'll use the select_battle_option tool to select RUN." },
                        { iteration: 15246, thought: "Oh, come on! Just when I was making good time. Another Diglett... alright, let's just get out of here. No time for battles right now!" }
                    ]
                };

                updateDisplay(mockData);

            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Initial load and periodic refresh
        fetchData();
        // setInterval(fetchData, 2000); // Uncomment this for live data from your server
    </script>
</body>

</html>